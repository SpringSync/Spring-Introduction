# ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

ë°ì´í„°: íšŒì›ID, ì´ë¦„
ê¸°ëŠ¥: íšŒì› ë“±ë¡, ì¡°íšŒ
ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•ŠìŒ(ê°€ìƒì˜ ì‹œë‚˜ë¦¬ì˜¤)

---

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/88a95228-3530-4db1-a09c-88f45cfea35b/aa332e25-2dd0-4764-86c0-3eace70fd194/Untitled.png)

- ì»¨íŠ¸ë¡¤ëŸ¬
    - ì›¹ MVCì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• 
    - í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ì§€ ì •ì˜
    - í™”ë©´ì—ì„œ ë„˜ì–´ì˜¤ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ì´ìš©í•´ ì„œë¹„ìŠ¤ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ëŠ” ì—­í• 

- ì„œë¹„ìŠ¤
    - í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
    - Http í†µì‹ ì„ ìœ„í•œ ê°ì²´(request, response)ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìœ¼ë©´ ì•ˆëœë‹¤(ì´ ì‘ì—…ì€ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œë§Œ)
    - ë°ì´í„°ë² ì´ìŠ¤ ì˜ì—­ê³¼ ë„ë©”ì¸ ì˜ì—­ì„ ì—°ê²°í•´ì£¼ëŠ” ë§¤ê°œì²´
    
- ë ˆí¬ì§€í† ë¦¬
    - ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬
    
- ë„ë©”ì¸
    - ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´
    - Entity(DB í…Œì´ë¸”ê³¼ ë§´í•‘ë˜ëŠ” ê°ì²´) í´ë˜ìŠ¤ë¼ê³ ë„ ë¶€ë¥¸ë‹¤

---

### í´ë˜ìŠ¤ ì˜ì¡´ê´€ê³„

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/88a95228-3530-4db1-a09c-88f45cfea35b/c30467c9-0654-45aa-b108-daac3fe9ac03/Untitled.png)

ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•Šì•„ì„œ, ìš°ì„  ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„

---

# íšŒì› ë„ë©”ì¸ê³¼ ë ˆí¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

---

- **Optional??**
    
    ****NPE(NullPointerException)Â ì´ë€?****
    
    NPEë¥¼ í”¼í•˜ë ¤ë©´ null ì—¬ë¶€ë¥¼ ê²€ì‚¬í•´ì•¼ í•˜ëŠ”ë°, null ê²€ì‚¬ë¥¼ í•´ì•¼í•˜ëŠ” ë³€ìˆ˜ê°€ ë§ì€ ê²½ìš° ì½”ë“œê°€ ë³µì¡í•´ì§€ê³  ë²ˆê±°ë¡­ë‹¤.
    
    ****Optionalì´ë€?****
    
    Java8ì—ì„œëŠ” Optional<T> í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ NPEë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.
    nullì´ ì˜¬ ìˆ˜ ìˆëŠ” ê°’ì„ ê°ì‹¸ëŠ” Wrapper í´ë˜ìŠ¤ â†’ ì°¸ì¡°í•˜ë”ë¼ë„ NPEê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë„ì™€ì¤€ë‹¤.
    
    Optional.of() - ê°’ì´ Nullì´ ì•„ë‹Œ ê²½ìš°
    
    ```jsx
    Optional<String> optional = Optional.of("MyName");
    ```
    
    Optional.ofNullbale() - ê°’ì´ Nullì¼ìˆ˜ë„, ì•„ë‹ìˆ˜ë„ ìˆëŠ” ê²½ìš°
    
    ```jsx
    Optional<String> optional = Optional.ofNullable(getName());
    
    String name = optional.orElse("anonymous"); // ê°’ì´ ì—†ë‹¤ë©´ "anonymous" ë¥¼ ë¦¬í„´
    ```
    
    ++) 
    
    - orElse: íŒŒë¼ë¯¸í„°ë¡œ ê°’ì„ ë°›ëŠ”ë‹¤.
    - orElseGet: íŒŒë¼ë¯¸í„°ë¡œ í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤(í•¨ìˆ˜)ë¥¼ ë°›ëŠ”ë‹¤.
    
    [ê°•ì˜ ì˜ˆì œì—ì„œì˜ Optional ì‚¬ìš©]
    
    - ì˜ˆì „
    
    ```jsx
    @Override
        public Optional<Member> findById(Long id) {
            return store.get(id);
        }
    ```
    
    - ìš”ì¦˜
    
    ```jsx
    @Override
        public Optional<Member> findById(Long id) {
            return Optional.ofNullable(store.get(id));
        }
    ```
    
    store.get(id)ê°€ null ê°’ì´ ë‚˜ì™€ë„ í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ ì²˜ë¦¬ê°€ëŠ¥!!
    

---

# íšŒì› ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„± - ì½”ë“œê²€ì¦

- í…ŒìŠ¤íŠ¸ í•  ë•Œ 1) main ë©”ì†Œë“œì—ì„œ ì‹¤í–‰, 2) ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼  í†µí•´ì„œ ì‹¤í–‰
    
    3) ìë°”ëŠ” JUnitì´ë¼ëŠ” í”„ë ˆì„ì›Œí¬ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰
    

- save í…ŒìŠ¤íŠ¸

```jsx
class MemoryMemberRepositoryTest {
    MemberRepository repository = new MemoryMemberRepository();

    @Test
    public void save(){
        Member member = new Member();
        member.setName("spring");

        repository.save(member);

        Member result = repository.findById(member.getId()).get();

        System.out.println("result =" + (result == member));
    }
}
```

<aside>
ğŸ’¡ result =true

</aside>

```jsx
Assertions.assertEquals(member,null);
```

<aside>
ğŸ’¡ org.opentest4j.AssertionFailedError:
Expected :hello.hellospring.domain.Member@6b419da
Actual   :null

</aside>

```jsx
Assertions.assertThat(member).isEqualTo(result);
```

```jsx
assertThat(member).isEqualTo(result);
```

- findByName í…ŒìŠ¤íŠ¸

```jsx
@Test
    public void findByName() {
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        Member result=repository.findByName("spring1").get(); //ctrl + alt+ v

        assertThat(result).isEqualTo(member1);
    }
```

- ìˆœì„œ ë³´ì¥ì´ ì•ˆë¨ â†’ ê·¸ë˜ì„œ findByNameì—ì„œ ì—ëŸ¬
    - ìˆœì„œ ìƒê´€ì—†ì´ ë©”ì†Œë“œë§ˆë‹¤ ë”°ë¡œ ë™ì‘í•˜ê²Œ ì„¤ê³„í•´ì•¼í•¨
    - testê°€ ëë‚ ë•Œë§ˆë‹¤ ë°ì´í„° ì´ˆê¸°í™” (ë ˆí¬ ì§€ì›Œì£¼ê¸°)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/88a95228-3530-4db1-a09c-88f45cfea35b/6f29944c-c6c2-435d-ab83-56a0118cf3a7/Untitled.png)

- testê°€ ëë‚ ë•Œë§ˆë‹¤ ë°ì´í„° ì´ˆê¸°í™” (ë ˆí¬ ì§€ì›Œì£¼ê¸°) - AfterEach
    - ë©”ì†Œë“œ ì‹¤í–‰ì´ ëë‚ ë•Œë§ˆë‹¤ ë™ì‘(ì½œë°± ë©”ì†Œë“œ)
    - 
    

---

# íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

```jsx
//ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì›X
        Optional<Member> result = memberRepository.findByName(member.getName());
       //resultì— ê°’ì´ ìˆìœ¼ë©´ ë™ì‘
        result.ifPresent(m ->{
            throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤");
        });
```

```jsx
//ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì›X
       memberRepository.findByName(member.getName())
               .ifPresent(m ->{
                    throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤");
                });
```

â†’ ì´ê²½ìš°ì—ëŠ” ë©”ì„œë“œë¥¼  ë½‘ëŠ”ê²Œ ì¢‹ìŒ

ctrl + shift + alt + T

```jsx
private void validateDuplicateMember(Member member) {
        memberRepository.findByName(member.getName())
                .ifPresent(m ->{
                     throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤");
                 });
    }
```

---

# íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

[MemberService.java](http://MemberService.java) ì— ìˆëŠ” `memberRepository` ê°ì²´

`private final MemberRepository memberRepository = new MemoryMemberRepository();`

[MemberServiceTest.java](http://MemberService.java)ì— ìˆëŠ” `memberRepository` ê°ì²´

`MemoryMemberRepository memberRepository = new MemoryMemberRepository();`

ë‘ê°œê°€ ë‹¤ë¥¸ ë¦¬í¬ì§€í† ë¦¬,ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤

ë‘ê°œë¥¼ ì“¸ ì´ìœ ê°€ X

- [MemberService.jav](http://MemberService.java)a

```jsx
//ì™¸ë¶€ì—ì„œ ìƒì„±ìœ¼ë¡œ ë°”ê¿ˆ
    public MemberService(MemberRepository memberRepository){
        this.memberRepository=memberRepository;
    }
```

- [MemberServiceTest.java](http://MemberService.java)

```jsx
		MemberService memberService;
    MemoryMemberRepository memberRepository;

    //ë™ì‘í•˜ê¸° ì „(ê°™ì€ ë©”ëª¨ë¦¬ ë¦¬í¬ì§€í† ë¦¬ê°€ ì‚¬ìš©ë¨)
    @BeforeEach
    public void beforeEach(){
        memberRepository = new MemoryMemberRepository();
        memberService =new MemberService(memberRepository);
    }
```
